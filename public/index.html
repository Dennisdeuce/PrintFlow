<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PrintFlow â€” Bulk Product Creator</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--bg:#0a0e17;--surface:#111827;--surface2:#1a2234;--border:#1e293b;--text:#e2e8f0;--text-dim:#64748b;--accent:#c8ff00;--accent-dim:rgba(200,255,0,0.1);--green:#10b981;--red:#ef4444;--amber:#f59e0b;--blue:#3b82f6}*{margin:0;padding:0;box-sizing:border-box}body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;line-height:1.6;min-height:100vh}.container{max-width:1100px;margin:0 auto;padding:32px 24px}header{display:flex;align-items:center;justify-content:space-between;margin-bottom:40px;padding-bottom:24px;border-bottom:1px solid var(--border)}header h1{font-size:28px;font-weight:700;letter-spacing:-0.5px}header h1 span{color:var(--accent)}.status-badge{font-family:'JetBrains Mono',monospace;font-size:12px;padding:6px 14px;border-radius:20px;display:flex;align-items:center;gap:8px}.status-badge.connected{background:rgba(16,185,129,0.1);color:var(--green)}.status-badge.disconnected{background:rgba(239,68,68,0.1);color:var(--red)}.status-badge .dot{width:8px;height:8px;border-radius:50%;background:currentColor}.step{margin-bottom:40px}.step-header{display:flex;align-items:center;gap:12px;margin-bottom:20px}.step-num{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:var(--bg);background:var(--accent);width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center}.step-header h2{font-size:20px;font-weight:700}.upload-zone{border:2px dashed var(--border);border-radius:16px;padding:48px;text-align:center;cursor:pointer;transition:all 0.2s}.upload-zone:hover,.upload-zone.dragover{border-color:var(--accent);background:var(--accent-dim)}.upload-zone .icon{font-size:48px;margin-bottom:12px}.upload-zone p{color:var(--text-dim);font-size:15px}.upload-zone .hint{font-size:13px;color:var(--text-dim);margin-top:8px;opacity:0.6}input[type="file"]{display:none}.design-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:16px;margin-top:20px}.design-card{background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden;position:relative}.design-card img{width:100%;height:180px;object-fit:contain;background:var(--surface2);padding:12px}.design-card .info{padding:12px}.design-card .name-input{width:100%;background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:6px 8px;border-radius:6px;font-size:13px;font-family:'DM Sans',sans-serif}.design-card .remove{position:absolute;top:8px;right:8px;background:rgba(0,0,0,0.7);color:var(--red);border:none;border-radius:6px;width:28px;height:28px;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center}.design-card .remove:hover{background:var(--red);color:#fff}.product-types{display:flex;gap:12px;flex-wrap:wrap}.product-type{background:var(--surface);border:2px solid var(--border);border-radius:12px;padding:16px 24px;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:12px;user-select:none}.product-type:hover{border-color:var(--text-dim)}.product-type.selected{border-color:var(--accent);background:var(--accent-dim)}.product-type .emoji{font-size:28px}.product-type .label{font-weight:600;font-size:15px}.product-type .detail{font-size:12px;color:var(--text-dim)}.pricing-row{display:flex;gap:24px;margin-top:16px;flex-wrap:wrap}.pricing-item{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px 18px;font-size:13px}.pricing-item .price{font-family:'JetBrains Mono',monospace;font-weight:700;font-size:18px;color:var(--accent)}.pricing-item .desc{color:var(--text-dim);font-size:12px}.summary-bar{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px 24px;display:flex;align-items:center;justify-content:space-between;margin-top:24px;flex-wrap:wrap;gap:16px}.summary-stat{text-align:center}.summary-stat .num{font-family:'JetBrains Mono',monospace;font-size:24px;font-weight:700}.summary-stat .label{font-size:12px;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.5px}.btn-create{background:var(--accent);color:var(--bg);border:none;padding:14px 40px;border-radius:10px;font-size:16px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.2s;text-transform:uppercase;letter-spacing:1px}.btn-create:hover{transform:translateY(-1px);box-shadow:0 4px 20px rgba(200,255,0,0.3)}.btn-create:disabled{opacity:0.4;cursor:not-allowed;transform:none;box-shadow:none}.progress-section{margin-top:24px;display:none}.progress-section.active{display:block}.progress-bar-track{width:100%;height:8px;background:var(--surface2);border-radius:8px;overflow:hidden;margin:12px 0}.progress-bar-fill{height:100%;background:var(--accent);border-radius:8px;transition:width 0.5s ease;width:0%}.progress-log{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:16px;max-height:300px;overflow-y:auto;font-family:'JetBrains Mono',monospace;font-size:12px;line-height:2}.log-entry{padding:2px 0}.log-entry.success{color:var(--green)}.log-entry.error{color:var(--red)}.log-entry.info{color:var(--text-dim)}.results-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;margin-top:16px}.result-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 18px;display:flex;align-items:center;gap:12px}.result-card .status-icon{font-size:20px}.result-card .result-name{font-size:13px;font-weight:500}.result-card .result-type{font-size:11px;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.5px}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Print<span>Flow</span></h1>
    <div id="statusBadge" class="status-badge disconnected">
      <span class="dot"></span>
      <span id="statusText">Checking...</span>
    </div>
  </header>

  <div class="step">
    <div class="step-header"><div class="step-num">1</div><h2>Upload Designs</h2></div>
    <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
      <div class="icon">&#127912;</div>
      <p>Drop design files here or click to browse</p>
      <div class="hint">PNG recommended &#8226; Max 50MB per file &#8226; Up to 30 designs at once</div>
    </div>
    <input type="file" id="fileInput" multiple accept="image/png,image/jpeg,image/svg+xml">
    <div class="design-grid" id="designGrid"></div>
  </div>

  <div class="step">
    <div class="step-header"><div class="step-num">2</div><h2>Product Types</h2></div>
    <div class="product-types">
      <div class="product-type selected" data-type="tee" onclick="toggleType(this)">
        <div class="emoji">&#128085;</div>
        <div><div class="label">Performance Tee</div><div class="detail">A4 Cooling Crew &#8226; 7 colors &#8226; 7 sizes</div></div>
      </div>
      <div class="product-type selected" data-type="hoodie" onclick="toggleType(this)">
        <div class="emoji">&#129509;</div>
        <div><div class="label">Hoodie</div><div class="detail">Gildan Heavy Blend &#8226; 12 colors &#8226; 6 sizes</div></div>
      </div>
      <div class="product-type selected" data-type="hat" onclick="toggleType(this)">
        <div class="emoji">&#129506;</div>
        <div><div class="label">Trucker Cap</div><div class="detail">Richardson 112 &#8226; 5 colors &#8226; One size</div></div>
      </div>
    </div>
    <div class="pricing-row">
      <div class="pricing-item"><div class="price">$26.95</div><div class="desc">Tee base price</div></div>
      <div class="pricing-item"><div class="price">$36.75</div><div class="desc">Hoodie base price</div></div>
      <div class="pricing-item"><div class="price">$24.95</div><div class="desc">Hat price</div></div>
    </div>
  </div>

  <div class="step">
    <div class="step-header"><div class="step-num">3</div><h2>Create Products</h2></div>
    <div class="summary-bar">
      <div class="summary-stat"><div class="num" id="designCount">0</div><div class="label">Designs</div></div>
      <div class="summary-stat"><div class="num" id="typeCount">3</div><div class="label">Product Types</div></div>
      <div class="summary-stat"><div class="num" id="totalProducts">0</div><div class="label">Total Products</div></div>
      <div class="summary-stat"><div class="num" id="totalVariants">0</div><div class="label">Total Variants</div></div>
      <button class="btn-create" id="createBtn" onclick="startBulkCreate()" disabled>&#128640; Create All Products</button>
    </div>
    <div class="progress-section" id="progressSection">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px">
        <span id="progressText" style="font-size:14px">Starting...</span>
        <span id="progressPercent" style="font-family:'JetBrains Mono',monospace;font-size:14px;color:var(--accent)">0%</span>
      </div>
      <div class="progress-bar-track"><div class="progress-bar-fill" id="progressBar"></div></div>
      <div class="progress-log" id="progressLog"></div>
    </div>
    <div id="resultsSection" style="display:none;margin-top:24px">
      <h3 style="font-size:18px;margin-bottom:8px;color:var(--green)">&#9989; Creation Complete</h3>
      <p style="color:var(--text-dim);font-size:14px;margin-bottom:16px">Products are syncing to Shopify. They'll appear as drafts in your store within a few minutes.</p>
      <div class="results-grid" id="resultsGrid"></div>
    </div>
  </div>
</div>

<script>
let uploadedDesigns=[];let selectedTypes=new Set(['tee','hoodie','hat']);const VARIANT_COUNTS={tee:49,hoodie:72,hat:5};

async function checkStatus(){try{const r=await fetch('/api/status');const d=await r.json();const b=document.getElementById('statusBadge');const t=document.getElementById('statusText');if(d.ok){b.className='status-badge connected';t.textContent='Connected: '+d.store.name}else{b.className='status-badge disconnected';t.textContent=d.error||'Disconnected'}}catch(e){document.getElementById('statusBadge').className='status-badge disconnected';document.getElementById('statusText').textContent='Server unreachable'}}
checkStatus();

const uploadZone=document.getElementById('uploadZone');const fileInput=document.getElementById('fileInput');
['dragenter','dragover'].forEach(e=>{uploadZone.addEventListener(e,ev=>{ev.preventDefault();uploadZone.classList.add('dragover')})});
['dragleave','drop'].forEach(e=>{uploadZone.addEventListener(e,ev=>{ev.preventDefault();uploadZone.classList.remove('dragover')})});
uploadZone.addEventListener('drop',e=>{if(e.dataTransfer.files.length)handleFiles(e.dataTransfer.files)});
fileInput.addEventListener('change',e=>{if(e.target.files.length)handleFiles(e.target.files)});

async function handleFiles(files){const fd=new FormData();for(const f of files)fd.append('designs',f);uploadZone.innerHTML='<div class="icon">&#9203;</div><p>Uploading...</p>';try{const r=await fetch('/api/upload',{method:'POST',body:fd});const d=await r.json();if(d.ok){uploadedDesigns.push(...d.files);renderDesigns()}else{alert('Upload failed: '+d.error)}}catch(e){alert('Upload error: '+e.message)}uploadZone.innerHTML='<div class="icon">&#127912;</div><p>Drop more designs or click to browse</p><div class="hint">PNG recommended</div>'}

function renderDesigns(){const g=document.getElementById('designGrid');g.innerHTML=uploadedDesigns.map((d,i)=>'<div class="design-card"><button class="remove" onclick="removeDesign('+i+')">&#10005;</button><img src="'+d.path+'" alt="'+d.designName+'"><div class="info"><input class="name-input" value="'+d.designName+'" onchange="uploadedDesigns['+i+'].designName=this.value;updateSummary();" placeholder="Design name"></div></div>').join('');updateSummary()}

function removeDesign(i){fetch('/api/upload/'+uploadedDesigns[i].id,{method:'DELETE'});uploadedDesigns.splice(i,1);renderDesigns()}

function toggleType(el){const t=el.dataset.type;el.classList.toggle('selected');if(selectedTypes.has(t))selectedTypes.delete(t);else selectedTypes.add(t);updateSummary()}

function updateSummary(){const d=uploadedDesigns.length;const t=selectedTypes.size;const p=d*t;let v=0;selectedTypes.forEach(t=>v+=VARIANT_COUNTS[t]||0);v*=d;document.getElementById('designCount').textContent=d;document.getElementById('typeCount').textContent=t;document.getElementById('totalProducts').textContent=p;document.getElementById('totalVariants').textContent=v.toLocaleString();document.getElementById('createBtn').disabled=d===0||t===0}

function addLog(msg,type='info'){const log=document.getElementById('progressLog');const e=document.createElement('div');e.className='log-entry '+type;e.textContent=new Date().toLocaleTimeString()+' \u2014 '+msg;log.appendChild(e);log.scrollTop=log.scrollHeight}

async function startBulkCreate(){const btn=document.getElementById('createBtn');btn.disabled=true;btn.textContent='\u23F3 Creating...';const sec=document.getElementById('progressSection');sec.classList.add('active');document.getElementById('progressLog').innerHTML='';const designs=uploadedDesigns.map(d=>({fileId:d.id,designName:d.designName}));const productTypes=Array.from(selectedTypes);const total=designs.length*productTypes.length;addLog('Starting bulk creation: '+designs.length+' designs \u00d7 '+productTypes.length+' types = '+total+' products');try{const r=await fetch('/api/bulk-create',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({designs,productTypes})});const data=await r.json();if(data.ok){for(const r of data.results)addLog('\u2713 Created: '+r.name,'success');for(const e of data.errors)addLog('\u2717 Failed: '+e.design+' ('+(e.type||'upload')+'): '+e.error,'error');addLog('Done! '+data.summary.created+' created, '+data.summary.failed+' failed',data.summary.failed>0?'error':'success');document.getElementById('progressBar').style.width='100%';document.getElementById('progressPercent').textContent='100%';document.getElementById('progressText').textContent='Complete \u2014 '+data.summary.created+' products created';if(data.results.length>0){document.getElementById('resultsSection').style.display='block';document.getElementById('resultsGrid').innerHTML=data.results.map(r=>'<div class="result-card"><div class="status-icon">\u2705</div><div><div class="result-name">'+r.name+'</div><div class="result-type">'+r.type+' \u2022 Syncing to Shopify</div></div></div>').join('')}}else{addLog('Error: '+data.error,'error')}}catch(e){addLog('Request failed: '+e.message,'error')}btn.textContent='\ud83d\ude80 Create All Products';btn.disabled=false}
</script>
</body>
</html>